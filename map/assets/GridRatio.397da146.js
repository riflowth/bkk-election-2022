var ot=Object.defineProperty,it=Object.defineProperties;var nt=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var at=Object.prototype.hasOwnProperty,rt=Object.prototype.propertyIsEnumerable;var j=(s,i,r)=>i in s?ot(s,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[i]=r,v=(s,i)=>{for(var r in i||(i={}))at.call(i,r)&&j(s,r,i[r]);if(N)for(var r of N(i))rt.call(i,r)&&j(s,r,i[r]);return s},x=(s,i)=>it(s,nt(i));import{L as lt,O as st,T as ct,d as dt,A as pt,V as ht,W as _,a as A,M as z,S as k,b as ut,c as gt,C as ft}from"./MapHelper.ef4e18d7.js";import{F as wt,p as mt,h as H,m as W,j as F,a as bt,_ as Tt,y as B,b as vt,D as xt}from"./index.b62750ab.js";import{D as Dt}from"./DistrictTooltip.f54834b7.js";lt.registerPlugin(st);const Et=({onDistrictClick:s})=>{const i=wt(mt),r=H(null),w=H(null),[L,K]=W(),[D,Y]=W(),[I,q]=W(!1),M=H(0),[m,y]=W({show:!1,district:void 0,left:"unset",top:"unset",bottom:"unset",pointUp:!0,anchorRight:!1});if(!i)return F(bt,{});const{electionData:J,candidateMap:P}=i,[S,X]=W([]);let O=5e4;const V=e=>{let t=P[e];return t?t.color:xt},Z=new ct({fontFamily:"Anuphan",fontSize:20,fontStyle:"normal",fontWeight:"600",fill:"#ffffff",stroke:"#000000",strokeThickness:6,lineJoin:"round",textBaseline:"bottom"}),Q=(e,t)=>{e.on("pointerdown",h=>{M.current=Date.now()}),e.on("pointerup",h=>{Date.now()-M.current<ft&&t()})},$=(e,t)=>{if(S.length>0){tt(t);const h=e.loader.resources.stripe.animation,a=100,d=20,R=23;S.forEach(p=>{const{coordinate:n,district:c,ratio:b,districtCandidateVoteRatio:u}=p,l=Math.sqrt(a*a*b),T=n.col*a+a*.5-l*.5+n.col*d;let g=n.row*a+a*.5-l*.5+n.row*d;g+=R;const o=new k;o.beginFill(4473924),o.drawRect(T,g,l,l),o.endFill(),o.interactive=!0,o.buttonMode=!0,Q(o,()=>s==null?void 0:s(c)),o.on("pointerover",f=>{o.tint=6710886,y(C=>x(v({},C),{district:c,show:!0}))}),o.on("pointerout",f=>{o.tint=16777215,y(C=>x(v({},C),{show:!1}))});let U=0;if(u.forEach(({percentage:f,color:C},et)=>{if(et>z-1)return;const G=l*f/100;o.lineStyle(1,0,1),o.beginFill(+C.replace("#","0x"),1,!0),o.drawRect(T,g+U,l,G),o.endFill(),U+=G}),typeof c.voting.progress!="undefined"&&c.voting.progress<100){const f=o.getBounds();o.beginTextureFill({alpha:.2,texture:h==null?void 0:h.texture,matrix:new ut(f.width/30,0,0,f.height/30,f.x,f.y)}),o.drawRect(T,g,l,l),o.endFill()}t.addChild(o);const E=new gt(c.name,Z);E.x=T+l*.5,E.y=g-10,E.anchor.set(.5),t.addChild(E)})}},tt=e=>{const t=new k;t.lineStyle(50,16777215,.3),t.moveTo(530,0),t.lineTo(530,170),t.lineTo(410,170),t.lineTo(410,530),t.lineTo(530,530),t.lineTo(530,770),t.lineTo(770,770),t.lineTo(770,650),t.lineTo(1010,650),t.lineTo(1010,740),e.addChild(t)};return Tt(()=>{if(!i)return;const{districts:e}=J;let t=e.reduce((a,d)=>a.voting.eligiblePopulation>d.voting.eligiblePopulation?a:d);t&&(O=t.voting.eligiblePopulation);let h=[];e.forEach(a=>{const{voting:d}=a;let R=d.eligiblePopulation/O,p=[],n=0;d.result.forEach((c,b)=>{b===d.result.length-1?p.push({percentage:100-n,color:V(c.candidateId)}):(p.push({percentage:Math.floor(c.count/d.totalVotes*100),color:V(c.candidateId)}),n+=c.count/d.totalVotes*100)}),h.push(new dt(a,P,R,p))}),X(h)},[i]),B(()=>{var t,h,a;if(!w.current)return;const e=new pt({width:((t=w.current.parentElement)==null?void 0:t.clientWidth)||window.innerWidth,height:((h=w.current.parentElement)==null?void 0:h.clientHeight)||window.innerWidth,backgroundColor:0,antialias:!0,resolution:2,autoDensity:!0});return e.loader.add("stripe","/map/images/strip-black.gif"),e.loader.load((d,R)=>{var c,b;const p=R.stripe.animation;p&&(p.x=-p.width,p.y=-p.height,e.stage.addChild(p));const n=new ht({screenWidth:(c=w.current)==null?void 0:c.clientWidth,screenHeight:(b=w.current)==null?void 0:b.clientHeight,worldWidth:_,worldHeight:A,passiveWheel:!1,stopPropagation:!0,interaction:e.renderer.plugins.interaction});e.stage.addChild(n),n.on("pointermove",u=>{if(r.current){const{clientHeight:l,clientWidth:T}=r.current,g=!(u.data.global.y>l*.33);y(o=>x(v({},o),{left:u.data.global.x-15,top:g?u.data.global.y+20:"unset",bottom:g?"unset":l-u.data.global.y+10,pointUp:g,anchorRight:u.data.global.x>T*.66}))}}),n.on("pointerdown",u=>{u.target.cursor!=="pointer"&&y(l=>x(v({},l),{show:!1}))}),n.drag().pinch().wheel(),n.clampZoom({minWidth:300,minHeight:300,maxWidth:2e3,maxHeight:2e3}),n.fit(),n.moveCenter(_/2,A/2),K(e),Y(n),q(!0)}),(a=w.current)==null||a.appendChild(e.view),e.start(),()=>{e.destroy(!0)}},[]),B(()=>{L&&D&&I&&(D.removeChildren(),$(L,D),y(e=>x(v({},e),{show:!1})),D.fit(),D.moveCenter(_/2,A/2))},[I,S]),vt("div",{className:"relative h-full",class:"overflow-hidden",ref:r,children:[F("div",{className:"w-full h-full",ref:w}),F(Dt,{show:m.show,district:m.district,style:{left:m.left,top:m.top,bottom:m.bottom},pointUp:m.pointUp,topCandidateDisplay:z,anchorRight:m.anchorRight})]})};export{Et as default};

var J=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var B=(s,n,a)=>n in s?J(s,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[n]=a,m=(s,n)=>{for(var a in n||(n={}))Z.call(n,a)&&B(s,a,n[a]);if(L)for(var a of L(n))q.call(n,a)&&B(s,a,n[a]);return s},E=(s,n)=>X(s,Y(n));import{L as Q,O as $,T as tt,D as et,A as ot,V as nt,W as C,a as R,M as it,S as M,b as rt,c as at}from"./MapHelper.e67a14dc.js";import{F as st,p as lt,h as S,m as D,j as A,a as ct,_ as dt,y as P,b as ut}from"./index.c29b28f7.js";import{D as pt}from"./DistrictTooltip.89feee6d.js";const ht=200;Q.registerPlugin($);const Et=({onDistrictClick:s})=>{const n=st(lt),a=S(null),p=S(null),[H,I]=D(),[b,O]=D(),[_,U]=D(!1),F=S(0),[h,T]=D({show:!1,district:void 0,left:"unset",top:"unset",bottom:"unset",pointUp:!0,anchorRight:!1});if(!n)return A(ct,{});const{electionData:G,candidateMap:j}=n,[y,N]=D([]),V=new tt({fontFamily:"Anuphan",fontSize:20,fontStyle:"normal",fontWeight:"600",fill:"#ffffff",stroke:"#000000",strokeThickness:6,lineJoin:"round",textBaseline:"bottom"}),k=(e,t)=>{e.on("pointerdown",l=>{F.current=Date.now()}),e.on("pointerup",l=>{Date.now()-F.current<ht&&t()})},z=(e,t)=>{if(y.length>0){K(t);const l=e.loader.resources.stripe.animation,i=100,g=20;y.forEach(W=>{const{coordinate:c,district:r,highestScoreCandidate:x}=W,w=c.col*i+c.col*g,d=c.row*i+c.row*g,o=new M;if(x&&o.beginFill(+x.color.replace("#","0x"),1,!0),o.drawRoundedRect(w,d,i,i,2),o.endFill(),o.interactive=!0,o.buttonMode=!0,k(o,()=>s==null?void 0:s(r)),o.on("pointerover",u=>{o.tint=6710886,T(v=>E(m({},v),{district:r,show:!0}))}),o.on("pointerout",u=>{o.tint=16777215,T(v=>E(m({},v),{show:!1}))}),typeof r.voting.progress!="undefined"&&r.voting.progress<100){const u=o.getBounds();o.beginTextureFill({alpha:.2,texture:l==null?void 0:l.texture,matrix:new rt(u.width/30,0,0,u.height/30,u.x,u.y)}),o.drawRect(w,d,i,i),o.endFill()}t.addChild(o);const f=new at(r.name==="\u0E1B\u0E49\u0E2D\u0E21\u0E1B\u0E23\u0E32\u0E1A\u0E28\u0E31\u0E15\u0E23\u0E39\u0E1E\u0E48\u0E32\u0E22"?"\u0E1B\u0E49\u0E2D\u0E21\u0E1B\u0E23\u0E32\u0E1A\u0E2F":r.name,V);f.x=w+i*.5,f.y=d+i*.5,f.anchor.set(.5),t.addChild(f)})}},K=e=>{const t=new M;t.lineStyle(50,16777215,.3),t.moveTo(530,0),t.lineTo(530,170),t.lineTo(410,170),t.lineTo(410,530),t.lineTo(530,530),t.lineTo(530,770),t.lineTo(770,770),t.lineTo(770,650),t.lineTo(1010,650),t.lineTo(1010,740),e.addChild(t)};return dt(()=>{if(!n)return;const{districts:e}=G;let t=e.reduce((i,g)=>i.voting.eligiblePopulation>g.voting.eligiblePopulation?i:g);t&&t.voting.eligiblePopulation;let l=[];e.forEach(i=>{l.push(new et(i,j))}),N(l)},[n]),P(()=>{var t,l,i;if(!p.current)return;const e=new ot({width:((t=p.current.parentElement)==null?void 0:t.clientWidth)||window.innerWidth,height:((l=p.current.parentElement)==null?void 0:l.clientHeight)||window.innerWidth,backgroundColor:0,antialias:!0,resolution:2,autoDensity:!0});return e.loader.add("stripe","/map/images/strip-black.gif"),e.loader.load((g,W)=>{var x,w;const c=W.stripe.animation;c&&(c.x=-c.width,c.y=-c.height,e.stage.addChild(c));const r=new nt({screenWidth:(x=p.current)==null?void 0:x.clientWidth,screenHeight:(w=p.current)==null?void 0:w.clientHeight,worldWidth:C,worldHeight:R,passiveWheel:!1,stopPropagation:!0,interaction:e.renderer.plugins.interaction});e.stage.addChild(r),r.on("pointermove",d=>{if(a.current){const{clientWidth:o,clientHeight:f}=a.current,u=!(d.data.global.y>f*.33);T(v=>E(m({},v),{left:d.data.global.x-15,top:u?d.data.global.y+20:"unset",bottom:u?"unset":f-d.data.global.y+10,pointUp:u,anchorRight:d.data.global.x>o*.66}))}}),r.on("pointerdown",d=>{d.target.cursor!=="pointer"&&T(o=>E(m({},o),{show:!1}))}),r.drag().pinch().wheel(),r.clampZoom({minWidth:300,minHeight:300,maxWidth:2e3,maxHeight:2e3}),r.fit(),r.moveCenter(C/2,R/2),I(e),O(r),U(!0)}),(i=p.current)==null||i.appendChild(e.view),e.start(),()=>{e.destroy(!0)}},[]),P(()=>{H&&b&&_&&(b.removeChildren(),z(H,b),T(e=>E(m({},e),{show:!1})),b.fit(),b.moveCenter(C/2,R/2))},[_,y]),ut("div",{className:"relative h-full",class:"overflow-hidden",ref:a,children:[A("div",{className:"w-full h-full",ref:p}),A(pt,{show:h.show,district:h.district,style:{left:h.left,top:h.top,bottom:h.bottom},pointUp:h.pointUp,topCandidateDisplay:it,anchorRight:h.anchorRight})]})};export{Et as default};

var X=Object.defineProperty,Y=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var M=(l,i,r)=>i in l?X(l,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[i]=r,m=(l,i)=>{for(var r in i||(i={}))q.call(i,r)&&M(l,r,i[r]);if(F)for(var r of F(i))Q.call(i,r)&&M(l,r,i[r]);return l},b=(l,i)=>Y(l,Z(i));import{L as $,O as tt,T as et,D as ot,A as nt,V as it,W as C,a as H,M as rt,S as P,b as at,c as lt}from"./MapHelper.14ab50a1.js";import{F as st,p as ct,h as S,m as W,j as _,a as dt,_ as pt,y as U,b as ht}from"./index.fdb936a0.js";import{D as ut}from"./DistrictTooltip.b715648d.js";const gt=200;$.registerPlugin(tt);const xt=({onDistrictClick:l})=>{const i=st(ct),r=S(null),u=S(null),[E,I]=W(),[T,O]=W(),[A,G]=W(!1),L=S(0),[g,x]=W({show:!1,district:void 0,left:"unset",top:"unset",bottom:"unset",pointUp:!0,anchorRight:!1});if(!i)return _(dt,{});const{electionData:j,candidateMap:N}=i,[R,V]=W([]),k=new et({fontFamily:"Anuphan",fontSize:20,fontStyle:"normal",fontWeight:"600",fill:"#ffffff",stroke:"#000000",strokeThickness:6,lineJoin:"round",textBaseline:"bottom"}),z=(t,e)=>{t.on("pointerdown",s=>{L.current=Date.now()}),t.on("pointerup",s=>{Date.now()-L.current<gt&&e()})},K=(t,e)=>{if(r.current){const{clientWidth:s,clientHeight:o}=r.current,p=!(t.data.global.y>o*.33);x(v=>b(m({},v),{district:e,show:!0,left:t.data.global.x-15,top:p?t.data.global.y+20:"unset",bottom:p?"unset":o-t.data.global.y+10,pointUp:p,anchorRight:t.data.global.x>s*.66}))}},B=(t,e)=>{if(R.length>0){J(e);const s=t.loader.resources.stripe.animation,o=100,p=20;R.forEach(v=>{const{coordinate:d,district:a,highestScoreCandidate:y}=v,f=d.col*o+d.col*p,c=d.row*o+d.row*p,n=new P;if(y&&n.beginFill(+y.color.replace("#","0x"),1,!0),n.drawRoundedRect(f,c,o,o,2),n.endFill(),n.interactive=!0,n.buttonMode=!0,z(n,()=>l==null?void 0:l(a)),n.on("pointerover",h=>{n.tint=6710886,x(D=>b(m({},D),{district:a,show:!0}))}),n.on("pointerout",h=>{n.tint=16777215,x(D=>b(m({},D),{show:!1}))}),n.on("pointerdown",h=>{n.tint=16777215,K(h,a)}),typeof a.voting.progress!="undefined"&&a.voting.progress<100){const h=o/50;n.beginTextureFill({alpha:.2,texture:s==null?void 0:s.texture,matrix:new at(h,0,0,h,f,c)}),n.drawRect(f,c,o,o),n.endFill()}e.addChild(n);const w=new lt(a.name,k);w.x=f+o*.5,w.y=c+o*.5,w.anchor.set(.5),e.addChild(w)})}},J=t=>{const e=new P;e.lineStyle(50,16777215,.3),e.moveTo(530,0),e.lineTo(530,170),e.lineTo(410,170),e.lineTo(410,530),e.lineTo(530,530),e.lineTo(530,770),e.lineTo(770,770),e.lineTo(770,650),e.lineTo(1010,650),e.lineTo(1010,740),t.addChild(e)};return pt(()=>{if(!i)return;const{districts:t}=j;let e=t.reduce((o,p)=>o.voting.eligiblePopulation>p.voting.eligiblePopulation?o:p);e&&e.voting.eligiblePopulation;let s=[];t.forEach(o=>{s.push(new ot(o,N))}),V(s)},[i]),U(()=>{var e,s,o;if(!u.current)return;const t=new nt({width:((e=u.current.parentElement)==null?void 0:e.clientWidth)||window.innerWidth,height:((s=u.current.parentElement)==null?void 0:s.clientHeight)||window.innerWidth,backgroundColor:0,antialias:!0,resolution:2,autoDensity:!0});return t.loader.add("stripe","/map/images/strip-black.gif"),t.loader.load((p,v)=>{var y,f;const d=v.stripe.animation;d&&(d.x=-d.width,d.y=-d.height,t.stage.addChild(d));const a=new it({screenWidth:(y=u.current)==null?void 0:y.clientWidth,screenHeight:(f=u.current)==null?void 0:f.clientHeight,worldWidth:C,worldHeight:H,interaction:t.renderer.plugins.interaction});t.stage.addChild(a),a.on("pointermove",c=>{if(r.current){const{clientWidth:n,clientHeight:w}=r.current,h=!(c.data.global.y>w*.33);x(D=>b(m({},D),{left:c.data.global.x-15,top:h?c.data.global.y+20:"unset",bottom:h?"unset":w-c.data.global.y+10,pointUp:h,anchorRight:c.data.global.x>n*.66}))}}),a.on("pointerdown",c=>{c.target.cursor!=="pointer"&&x(n=>b(m({},n),{show:!1}))}),a.drag().pinch().wheel(),a.clampZoom({minWidth:300,minHeight:300,maxWidth:2e3,maxHeight:2e3}),a.fit(),a.moveCenter(C/2,H/2),I(t),O(a),G(!0)}),(o=u.current)==null||o.appendChild(t.view),t.start(),()=>{t.destroy(!0)}},[]),U(()=>{E&&T&&A&&(T.removeChildren(),B(E,T),x(t=>b(m({},t),{show:!1})),T.fit(),T.moveCenter(C/2,H/2))},[A,R]),ht("div",{className:"relative h-full",class:"overflow-hidden",ref:r,children:[_("div",{className:"w-full h-full",ref:u}),_(ut,{show:g.show,district:g.district,style:{left:g.left,top:g.top,bottom:g.bottom},pointUp:g.pointUp,topCandidateDisplay:rt,anchorRight:g.anchorRight})]})};export{xt as default};

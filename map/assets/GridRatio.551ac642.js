var nt=Object.defineProperty,it=Object.defineProperties;var at=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var rt=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable;var j=(p,i,a)=>i in p?nt(p,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):p[i]=a,x=(p,i)=>{for(var a in i||(i={}))rt.call(i,a)&&j(p,a,i[a]);if(N)for(var a of N(i))lt.call(i,a)&&j(p,a,i[a]);return p},v=(p,i)=>it(p,at(i));import{L as st,O as ct,T as dt,d as pt,A as ht,V as ut,W as H,a as _,M as z,S as k,b as gt,c as ft,C as wt}from"./MapHelper.a6db83bd.js";import{F as mt,p as bt,h as A,m as W,j as F,a as Tt,_ as xt,y as K,b as vt,D as yt}from"./index.1927a5d3.js";import{D as Dt}from"./DistrictTooltip.296e585d.js";st.registerPlugin(ct);const St=({onDistrictClick:p})=>{const i=mt(bt),a=A(null),w=A(null),[L,Y]=W(),[R,q]=W(),[I,B]=W(!1),M=A(0),[m,y]=W({show:!1,district:void 0,left:"unset",top:"unset",bottom:"unset",pointUp:!0,anchorRight:!1});if(!i)return F(Tt,{});const{electionData:J,candidateMap:P}=i,[S,X]=W([]);let O=5e4;const U=t=>{let e=P[t];return e?e.color:yt},Z=new dt({fontFamily:"Anuphan",fontSize:20,fontStyle:"normal",fontWeight:"600",fill:"#ffffff",stroke:"#000000",strokeThickness:6,lineJoin:"round",textBaseline:"bottom"}),Q=(t,e)=>{t.on("pointerdown",s=>{M.current=Date.now()}),t.on("pointerup",s=>{Date.now()-M.current<wt&&e()})},$=(t,e)=>{if(a.current){const{clientHeight:s,clientWidth:n}=a.current,r=!(t.data.global.y>s*.33);y(b=>v(x({},b),{district:e,show:!0,left:t.data.global.x-15,top:r?t.data.global.y+20:"unset",bottom:r?"unset":s-t.data.global.y+10,pointUp:r,anchorRight:t.data.global.x>n*.66}))}},tt=(t,e)=>{if(S.length>0){et(e);const s=t.loader.resources.stripe.animation,n=100,r=20,b=23;S.forEach(h=>{const{coordinate:l,district:c,ratio:D,districtCandidateVoteRatio:g}=h,d=Math.sqrt(n*n*D),T=l.col*n+n*.5-d*.5+l.col*r;let u=l.row*n+n*.5-d*.5+l.row*r;u+=b;const o=new k;o.beginFill(4473924),o.drawRect(T,u,d,d),o.endFill(),o.interactive=!0,o.buttonMode=!0,Q(o,()=>p==null?void 0:p(c)),o.on("pointerover",f=>{o.tint=6710886,y(C=>v(x({},C),{district:c,show:!0}))}),o.on("pointerout",f=>{o.tint=16777215,y(C=>v(x({},C),{show:!1}))}),o.on("pointerdown",f=>{o.tint=16777215,$(f,c)});let V=0;if(g.forEach(({percentage:f,color:C},ot)=>{if(ot>z-1)return;const G=d*f/100;o.lineStyle(1,0,1),o.beginFill(+C.replace("#","0x"),1,!0),o.drawRect(T,u+V,d,G),o.endFill(),V+=G}),typeof c.voting.progress!="undefined"&&c.voting.progress<100){const f=n/50;o.beginTextureFill({alpha:.2,texture:s==null?void 0:s.texture,matrix:new gt(f,0,0,f,T,u)}),o.drawRect(T,u,d,d),o.endFill()}e.addChild(o);const E=new ft(c.name,Z);E.x=T+d*.5,E.y=u-10,E.anchor.set(.5),e.addChild(E)})}},et=t=>{const e=new k;e.lineStyle(50,16777215,.3),e.moveTo(530,0),e.lineTo(530,170),e.lineTo(410,170),e.lineTo(410,530),e.lineTo(530,530),e.lineTo(530,770),e.lineTo(770,770),e.lineTo(770,650),e.lineTo(1010,650),e.lineTo(1010,740),t.addChild(e)};return xt(()=>{if(!i)return;const{districts:t}=J;let e=t.reduce((n,r)=>n.voting.eligiblePopulation>r.voting.eligiblePopulation?n:r);e&&(O=e.voting.eligiblePopulation);let s=[];t.forEach(n=>{const{voting:r}=n;let b=r.eligiblePopulation/O,h=[],l=0;r.result.forEach((c,D)=>{D===r.result.length-1?h.push({percentage:100-l,color:U(c.candidateId)}):(h.push({percentage:Math.floor(c.count/r.totalVotes*100),color:U(c.candidateId)}),l+=c.count/r.totalVotes*100)}),s.push(new pt(n,P,b,h))}),X(s)},[i]),K(()=>{var e,s,n;if(!w.current)return;const t=new ht({width:((e=w.current.parentElement)==null?void 0:e.clientWidth)||window.innerWidth,height:((s=w.current.parentElement)==null?void 0:s.clientHeight)||window.innerWidth,backgroundColor:0,antialias:!0,resolution:2,autoDensity:!0});return t.loader.add("stripe","/map/images/strip-black.gif"),t.loader.load((r,b)=>{var c,D;const h=b.stripe.animation;h&&(h.x=-h.width,h.y=-h.height,t.stage.addChild(h));const l=new ut({screenWidth:(c=w.current)==null?void 0:c.clientWidth,screenHeight:(D=w.current)==null?void 0:D.clientHeight,worldWidth:H,worldHeight:_,interaction:t.renderer.plugins.interaction});t.stage.addChild(l),l.on("pointermove",g=>{if(a.current){const{clientHeight:d,clientWidth:T}=a.current,u=!(g.data.global.y>d*.33);y(o=>v(x({},o),{left:g.data.global.x-15,top:u?g.data.global.y+20:"unset",bottom:u?"unset":d-g.data.global.y+10,pointUp:u,anchorRight:g.data.global.x>T*.66}))}}),l.on("pointerdown",g=>{g.target.cursor!=="pointer"&&y(d=>v(x({},d),{show:!1}))}),l.drag().pinch().wheel(),l.clampZoom({minWidth:300,minHeight:300,maxWidth:2e3,maxHeight:2e3}),l.fit(),l.moveCenter(H/2,_/2),Y(t),q(l),B(!0)}),(n=w.current)==null||n.appendChild(t.view),t.start(),()=>{t.destroy(!0)}},[]),K(()=>{L&&R&&I&&(R.removeChildren(),tt(L,R),y(t=>v(x({},t),{show:!1})),R.fit(),R.moveCenter(H/2,_/2))},[I,S]),vt("div",{className:"relative h-full",class:"overflow-hidden",ref:a,children:[F("div",{className:"w-full h-full",ref:w}),F(Dt,{show:m.show,district:m.district,style:{left:m.left,top:m.top,bottom:m.bottom},pointUp:m.pointUp,topCandidateDisplay:z,anchorRight:m.anchorRight})]})};export{St as default};
